# Probing Tasks на замороженных эмбеддингах

## Обзор

Модуль `probe.py` добавляет в GenBench возможность проведения probing tasks на замороженных эмбеддингах DNA-LM. Это позволяет оценить, какую биологическую информацию языковые модели ДНК захватывают в процессе предобучения.

Для пробинга используются линейные классификаторы/регрессоры, которые обучаются на фиксированных эмбеддингах для предсказания различных биологических свойств.

## Теоретическое обоснование

Пробинг (probing) — это метод анализа нейронных сетей, который помогает понять, какие признаки или свойства данных захватываются в скрытых представлениях (эмбеддингах) модели.

В контексте моделей языка ДНК, пробинг позволяет определить, какие биологические свойства (например, наличие мотивов транскрипционных факторов, хроматиновые метки, уровни экспрессии) закодированы в эмбеддингах последовательностей ДНК.

Основная идея состоит в следующем:
1. Получаем эмбеддинги из предобученной модели
2. "Замораживаем" эмбеддинги (не обновляем веса модели)
3. Обучаем простой линейный классификатор/регрессор для предсказания целевого свойства
4. Оцениваем производительность модели как меру того, насколько хорошо информация о свойстве закодирована в эмбеддингах

## Использование

### Основные шаги

1. **Извлечение эмбеддингов** из замороженной модели DNA-LM для набора последовательностей
2. **Обучение линейного пробинг-классификатора** на этих эмбеддингах для предсказания биологических свойств
3. **Оценка производительности** пробинг-моделей для понимания, какую информацию захватила модель

### Примеры команд

#### Полный процесс (извлечение эмбеддингов + пробинг)

```bash
python examples/run_probe.py --data_path data/motifs.csv --label_column has_motif --model_path weight/hyenadna/hyenadna-large-1m-seqlen/weights.ckpt
```

#### Только извлечение эмбеддингов

```bash
python examples/run_probe.py --mode extract --data_path data/chromatin.csv --label_column accessibility --model_path weight/hyenadna/hyenadna-large-1m-seqlen/weights.ckpt --embeddings_path embeddings/chromatin_embeddings.npy
```

#### Только пробинг на предварительно извлеченных эмбеддингах

```bash
python examples/run_probe.py --mode probe --data_path data/expression.csv --label_column expression_level --embeddings_path embeddings/expression_embeddings.npy --model_type ridge
```

### Аргументы командной строки

- `--mode`: Режим работы (`extract`, `probe`, `full`)
- `--data_path`: Путь к файлу с данными (CSV, TSV, Excel)
- `--label_column`: Имя столбца с метками в данных
- `--seq_column`: Имя столбца с последовательностями ДНК (по умолчанию: "sequence")
- `--model_path`: Путь к весам модели (для режимов extract и full)
- `--embeddings_path`: Путь к файлу с предварительно посчитанными эмбеддингами
- `--device`: Устройство для вычислений (`cuda` или `cpu`)
- `--model_type`: Тип линейной модели для пробинга (`logistic` для классификации, `ridge` для регрессии)
- `--cross_validation`: Флаг для использования кросс-валидации
- `--cv_folds`: Количество фолдов для кросс-валидации (по умолчанию: 5)
- `--batch_size`: Размер пакета для извлечения эмбеддингов (по умолчанию: 32)
- `--output_dir`: Директория для сохранения результатов (по умолчанию: "probe_results")

## Примеры задач для пробинга

1. **Классификация мотивов**: Предсказание наличия или отсутствия определенных мотивов транскрипционных факторов (TF)
2. **Хроматиновые профили**: Предсказание доступности хроматина (например, DNase-seq, ATAC-seq)
3. **Метилирование ДНК**: Предсказание уровней метилирования CpG
4. **Экспрессия генов**: Предсказание уровней экспрессии генов
5. **Типы хроматина**: Классификация областей ДНК по типам хроматина (например, промоторы, энхансеры, гетерохроматин)
6. **Сплайсинг**: Предсказание сайтов сплайсинга или пропуска экзонов
7. **Эволюционное давление**: Предсказание уровней консервации последовательностей

## Интерпретация результатов

Высокая производительность пробинга на определенном свойстве указывает на то, что модель захватила это свойство в своих эмбеддингах. Это может помочь понять:

- Какие биологические свойства модель выучила неявно
- Насколько хорошо эмбеддинги отражают разные уровни биологической организации (от специфических мотивов до высокоуровневых функциональных категорий)
- Какие архитектуры моделей или стратегии предобучения лучше захватывают определенные типы биологической информации

Низкая производительность может указывать на:
- Недостаточное представление определенных признаков в эмбеддингах
- Необходимость тонкой настройки модели для конкретной задачи
- Несоответствие между предобучением и целевой задачей
